{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Australian States: Population and Crimes",
    "anchor": "start",
    "fontSize": 20,
    "fontWeight": "bold",
    "dy": -10
  },
  "width": 450,
  "height": 450,
  "data": {
    "url": "https://raw.githubusercontent.com/mooi0010-69/datavis2/refs/heads/main/cleaned_data/map.json",
    "format": {"type": "topojson", "feature": "LGA_2023_AUST_GDA94"}
  },
  "params": [
    {
      "name": "display_metric",
      "value": "Population",
      "bind": {
        "input": "select",
        "options": ["Population", "Total crimes"],
        "name": "Select Metric: "
      }
    }
  ],
  "transform": [
    {
      "lookup": "properties.STE_CODE21",
      "from": {
        "data": {
          "url": "https://raw.githubusercontent.com/mooi0010-69/datavis2/refs/heads/main/cleaned_data/total_pop.csv"
        },
        "key": "STATE_CODE",
        "fields": ["Population"]
      }
    },
    {
      "lookup": "properties.STE_CODE21",
      "from": {
        "data": {
          "url": "https://raw.githubusercontent.com/mooi0010-69/datavis2/refs/heads/main/cleaned_data/female_pop_state.csv"
        },
        "key": "STATE_CODE",
        "fields": ["Female_Population"]
      }
    },
    {
      "lookup": "properties.STE_CODE21",
      "from": {
        "data": {
          "url": "https://raw.githubusercontent.com/mooi0010-69/datavis2/refs/heads/main/cleaned_data/male_pop_state.csv"
        },
        "key": "STATE_CODE",
        "fields": ["Male_Population"]
      }
    },
    {
      "lookup": "properties.STE_NAME21",
      "from": {
        "data": {
          "url": "https://raw.githubusercontent.com/mooi0010-69/datavis2/refs/heads/main/cleaned_data/state_total_crime.csv"
        },
        "key": "State",
        "fields": ["total crimes"]
      }
    },
    {
      "calculate": "replace(datum['total crimes'], ',', '')",
      "as": "Total_Crimes_Num"
    },
    {
      "calculate": "display_metric == 'Population' ? datum.Population : toNumber(datum.Total_Crimes_Num)",
      "as": "DisplayValue"
    }
  ],
  "projection": {"type": "mercator"},
  "mark": {"type": "geoshape", "stroke": null},
  "encoding": {
    "color": {
      "field": "DisplayValue",
      "type": "quantitative",
      "scale": {
        "scheme": {"signal": "display_metric == 'Population' ? 'blues' : 'reds'"}
      },
      "legend": {
        "title": {
          "signal": "display_metric == 'Population' ? 'State Population' : 'State Crimes'"
        },
        "titleLimit": 0,
        "labelLimit": 0,
        "columns": 1,
        "orient": "right"
      }
    },
    "tooltip": [
      {"title": "State", "field": "properties.STE_NAME21"},
      {"title": "Population", "field": "Population", "type": "quantitative", "format": ","},
      {"title": "Total Crimes", "field": "Total_Crimes_Num", "type": "quantitative", "format": ","},
      {"title": "Male Population", "field": "Male_Population", "type": "quantitative", "format": ","},
      {"title": "Female Population", "field": "Female_Population", "type": "quantitative", "format": ","}
    ]
  },
  "config": {"view": {"stroke": "transparent"}}
}


