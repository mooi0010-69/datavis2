{
  "$schema": "https://vega.github.io/schema/vega/v6.json",
  "description": "treemap of australian state crimes with filters",
  "width": 775,
  "height": 400,
  "padding": 2.5,
  "autosize": "none",

  "signals": [
    {
      "name": "layout",
      "value": "squarify",
      "bind": {
        "name": "Treemap Layout: ",
        "input": "select",
        "options": ["squarify", "binary", "slicedice"]
      }
    },
    {
      "name": "aspectRatio",
      "value": 1.6,
      "bind": {
        "name": "Aspect Ratio: ",
        "input": "range",
        "min": 1,
        "max": 5,
        "step": 0.1
      }
    },
    {
      "name": "state_select",
      "value": "All",
      "bind": {
        "name": "Select State: ",
        "input": "select",
        "options": ["All","New South Wales","Victoria","Queensland","South Australia","Western Australia","Tasmania","Northern Territory","Australian Capital Territory"]
      }
    },
    {
      "name": "offence_select",
      "value": "All",
      "bind": {
        "name": "Select Offence: ",
        "input": "select",
        "options": [
          "All",
          "Homicide and related offences",
          "Acts intended to cause injury",
          "Sexual assault and related offences",
          "Dangerous/negligent acts",
          "Abduction/harassment",
          "Robbery/extortion",
          "Unlawful entry with intent",
          "Theft",
          "Fare evasion",
          "Fraud/deception",
          "Illicit drug offences",
          "Weapons/explosives",
          "Property damage and environmental pollution",
          "Public order offences",
          "Offences against justice",
          "Miscellaneous offences"
        ]
      }
    }
  ],

  "data": [
    {
      "name": "tree",
      "url": "https://raw.githubusercontent.com/mooi0010-69/datavis2/refs/heads/main/cleaned_data/states_crime_hier.csv",
      "format": {"type": "csv"},
      "transform": [
        {"type": "stratify","key": "id","parentKey": "parent"},
        {
          "type": "treemap",
          "field": "value",
          "sort": {"field": "value"},
          "round": true,
          "method": {"signal": "layout"},
          "ratio": {"signal": "aspectRatio"},
          "size": [{"signal": "width"}, {"signal": "height"}]
        }
      ]
    },
    {
      "name": "nodes",
      "source": "tree",
      "transform": [
        {
          "type": "filter",
          "expr": "datum.children && (state_select == 'All' || datum.name == state_select)"
        }
      ]
    },
    {
      "name": "leaves",
      "source": "tree",
      "transform": [
        {
          "type": "filter",
          "expr": "!datum.children && (state_select == 'All' || datum.parent == state_select) && (offence_select == 'All' || indexof(datum.id, offence_select) >= 0)"
        }
      ]
    }
  ],

  "scales": [
    {
      "name": "color",
      "type": "ordinal",
      "domain": ["New South Wales","Victoria","Queensland","South Australia","Western Australia","Tasmania","Northern Territory","Australian Capital Territory"],
      "range": ["#8D99AE", "#EF476F", "#9B59B6", "#06D6A0", "#FFD166", "#073B79", "#F77FBE", "#3A86FF"]
    }
  ],

  "legends": [
    {
      "fill": "color",
      "orient": "left",
      "title": "State",
      "titleAlign": "left",
      "labelAlign": "left"
    }
  ],

  "marks": [
    {
      "type": "rect",
      "from": {"data": "nodes"},
      "interactive": false,
      "encode": {
        "enter": {"fill": {"scale": "color", "field": "name"}},
        "update": {
          "x": {"field": "x0"},
          "y": {"field": "y0"},
          "x2": {"field": "x1"},
          "y2": {"field": "y1"}
        }
      }
    },
    {
      "type": "rect",
      "from": {"data": "leaves"},
      "encode": {
        "enter": {"stroke": {"value": "#fff"}},
        "update": {
          "x": {"field": "x0"},
          "y": {"field": "y0"},
          "x2": {"field": "x1"},
          "y2": {"field": "y1"},
          "fill": {"scale": "color", "field": "parent"}
        },
        "hover": {
          "tooltip": {
            "signal": "{'State': datum.parent, 'Offence': replace(datum.id, / \\(.*\\)$/, ''), 'Count': datum.value}"
          }
        }
      }
    }
  ]
}


